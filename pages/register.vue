<script setup>
import VOtpInput from "vue3-otp-input";
</script>

<template>
    <div class="flex w-full min-h-[100vh]">
        <div class="w-[100%] sm:w-[50%] md:w-[50%] lg:w-[40%] xl:w-[35%] bg-[#171717] sm:bglogin">
            <div
                class=" px-[30px] sm:px-[40px] md:px-[50px] lg:px-[60px] xl:px-[50px] 2xl:px-[110px] flex flex-col text-[#fff]">
                <div class=" w-full flex justify-center items-center mt-10">
                    <p class="text-[12px] sm:text-[11px] md:text-[11px] lg:text-[12px]"> مطمئن شوید در دامنه <span
                            class="text-[#FF7028] mx-1 cursor-pointer">https://arnitex.ir</span> هستید </p>
                </div>

                <div class="w-full mt-[50px]">
                    <svg xmlns="http://www.w3.org/2000/svg" width="229" height="30" viewBox="0 0 229 30" fill="none">
                        <path
                            d="M21.2186 2.3289C20.8463 1.71256 20.3107 1.20079 19.6656 0.844907C19.0204 0.489021 18.2885 0.301612 17.5434 0.301612C16.7984 0.301612 16.0665 0.489021 15.4213 0.844907C14.7762 1.20079 14.2406 1.71256 13.8683 2.3289L0.523722 24.4C0.180561 24.9676 -6.29539e-05 25.6115 1.64594e-08 26.2669C6.29869e-05 26.9223 0.18082 27.5662 0.52409 28.1338C0.867361 28.7013 1.36105 29.1726 1.95551 29.5002C2.54998 29.8278 3.22428 30.0002 3.9106 29.9999C4.5933 30.0021 5.26488 29.8349 5.85961 29.5147C6.45435 29.1946 6.95187 28.7324 7.30348 28.1736L15.5256 15.2032C15.7355 14.8721 16.0313 14.5983 16.3844 14.4082C16.7376 14.2181 17.1361 14.1182 17.5414 14.1182C17.9468 14.1182 18.3453 14.2181 18.6984 14.4082C19.0515 14.5983 19.3474 14.8721 19.5573 15.2032L27.7814 28.1736C28.1364 28.7295 28.6346 29.1891 29.2286 29.5089C29.8226 29.8286 30.4924 29.9978 31.1743 29.9999C31.8606 29.9996 32.5348 29.8269 33.1292 29.4993C33.7236 29.1717 34.2174 28.7006 34.5611 28.1333C34.9086 27.5669 35.0918 26.9222 35.0918 26.2657C35.0918 25.6092 34.9086 24.9646 34.5611 24.3981L21.2165 2.32703L21.2186 2.3289Z"
                            fill="white" />
                        <path
                            d="M106.611 0H103.55C103.05 0.000507813 102.57 0.190478 102.217 0.52819C101.863 0.865903 101.664 1.32382 101.664 1.80142V17.8986C101.666 17.9915 101.637 18.0827 101.582 18.1589C101.526 18.2352 101.446 18.2925 101.354 18.3226C101.264 18.3573 101.165 18.3633 101.071 18.3398C100.978 18.3163 100.894 18.2645 100.834 18.1922L85.7056 1.11844L85.2837 0.64083C85.1068 0.44065 84.8862 0.279768 84.6374 0.169428C84.3886 0.0590889 84.1177 0.00193794 83.8434 0.00199052H80.091C79.5908 0.00249833 79.1113 0.192468 78.7577 0.530181C78.4041 0.867894 78.2052 1.3257 78.2046 1.80329V28.1909C78.2052 28.6685 78.4041 29.1264 78.7577 29.4641C79.1113 29.8019 79.5908 29.9917 80.091 29.9922H83.1464C83.6465 29.9917 84.1258 29.8019 84.4795 29.4641C84.8331 29.1264 85.032 28.6685 85.0326 28.1909V12.0936C85.03 12.0006 85.0587 11.9093 85.1143 11.8331C85.17 11.7568 85.2497 11.6995 85.3419 11.6696C85.4318 11.6349 85.531 11.629 85.6248 11.6525C85.7185 11.676 85.8018 11.7277 85.8623 11.8L100.727 28.586L101.499 29.3974C101.677 29.5849 101.894 29.7348 102.136 29.837C102.378 29.9391 102.64 29.9913 102.905 29.9903H106.607C107.107 29.9898 107.587 29.7998 107.94 29.462C108.294 29.1243 108.493 28.6664 108.494 28.1888V1.80329C108.493 1.3257 108.294 0.867894 107.94 0.530181C107.587 0.192468 107.107 0.00249833 106.607 0.00199052L106.611 0Z"
                            fill="white" />
                        <path
                            d="M122.423 3.26319C122.423 1.46098 120.893 0 119.006 0C117.119 0 115.589 1.46098 115.589 3.26319V26.7251C115.589 28.5273 117.119 29.9883 119.006 29.9883C120.893 29.9883 122.423 28.5273 122.423 26.7251V3.26319Z"
                            fill="white" />
                        <path
                            d="M156.677 9.17941e-06H129.695C129.195 0.000516992 128.715 0.190487 128.362 0.5282C128.008 0.865912 127.809 1.32383 127.809 1.80143V5.31013C127.809 5.78773 128.008 6.24565 128.362 6.58336C128.715 6.92107 129.195 7.11104 129.695 7.11155H139.299C139.424 7.11206 139.544 7.15966 139.632 7.2441C139.721 7.32853 139.771 7.44294 139.771 7.56235V28.1869C139.772 28.6645 139.97 29.1225 140.324 29.4602C140.678 29.7979 141.157 29.988 141.657 29.9885H144.723C145.223 29.988 145.702 29.7979 146.056 29.4602C146.41 29.1225 146.609 28.6645 146.609 28.1869V7.56235C146.609 7.44278 146.659 7.32818 146.747 7.24363C146.836 7.15908 146.956 7.11155 147.081 7.11155H156.685C157.185 7.11104 157.665 6.92107 158.019 6.58336C158.372 6.24565 158.571 5.78773 158.572 5.31013V1.80143C158.571 1.5643 158.522 1.32954 158.427 1.1106C158.331 0.891663 158.192 0.69283 158.016 0.525507C157.84 0.358184 157.631 0.225646 157.401 0.135482C157.172 0.0453168 156.926 -0.000747768 156.677 9.17941e-06Z"
                            fill="white" />
                        <path
                            d="M189.979 0H165.835C165.335 0.000507813 164.856 0.190478 164.502 0.52819C164.149 0.865903 163.95 1.32382 163.949 1.80142V28.1888C163.95 28.6664 164.149 29.1243 164.502 29.462C164.856 29.7998 165.335 29.9898 165.835 29.9903H189.979C190.479 29.9898 190.959 29.7998 191.313 29.462C191.666 29.1243 191.865 28.6664 191.866 28.1888V24.6801C191.865 24.2025 191.666 23.7446 191.313 23.4069C190.959 23.0692 190.479 22.8793 189.979 22.8788H171.253C171.128 22.8788 171.008 22.8313 170.919 22.7467C170.831 22.6622 170.781 22.5476 170.781 22.428V19.0017C170.781 18.8822 170.831 18.7675 170.919 18.6829C171.008 18.5984 171.128 18.5509 171.253 18.5509H189.957C190.457 18.5504 190.937 18.3605 191.29 18.0228C191.644 17.685 191.843 17.2271 191.844 16.7495V13.2408C191.843 12.7632 191.644 12.3053 191.29 11.9676C190.937 11.6299 190.457 11.4399 189.957 11.4394H171.253C171.128 11.4394 171.008 11.392 170.919 11.3074C170.831 11.2229 170.781 11.1082 170.781 10.9886V7.56234C170.781 7.44277 170.831 7.32817 170.919 7.24362C171.008 7.15907 171.128 7.11154 171.253 7.11154H189.979C190.479 7.11104 190.959 6.92107 191.313 6.58335C191.666 6.24564 191.865 5.78772 191.866 5.31012V1.80142C191.865 1.32382 191.666 0.865903 191.313 0.52819C190.959 0.190478 190.479 0.000507813 189.979 0Z"
                            fill="white" />
                        <path
                            d="M220.499 12.318L228.569 2.9448C228.796 2.68114 228.939 2.36145 228.983 2.02284C229.027 1.68423 228.97 1.34066 228.817 1.03214C228.664 0.723629 228.423 0.462786 228.121 0.280078C227.82 0.0973699 227.47 0.000220648 227.112 2.7739e-07H223.095C222.816 -0.000147859 222.54 0.0590381 222.288 0.173176C222.036 0.287313 221.813 0.453651 221.636 0.660033L216.068 7.1537L220.499 12.318Z"
                            fill="white" />
                        <path
                            d="M228.569 27.0474L205.925 0.661778C205.749 0.455396 205.526 0.289175 205.274 0.175038C205.022 0.0609003 204.746 0.00171434 204.467 0.00186248H200.45C200.092 0.00201748 199.743 0.0990016 199.441 0.281472C199.139 0.463942 198.898 0.724482 198.745 1.03272C198.593 1.34095 198.535 1.68423 198.578 2.02271C198.622 2.36118 198.765 2.68086 198.991 2.94467L209.09 14.7122C209.159 14.7934 209.197 14.895 209.197 14.9998C209.197 15.1047 209.159 15.2064 209.09 15.2877L198.991 27.0533C198.765 27.3171 198.622 27.6368 198.578 27.9752C198.535 28.3137 198.593 28.6569 198.745 28.9651C198.898 29.2733 199.139 29.5339 199.441 29.7163C199.743 29.8988 200.092 29.9958 200.45 29.996H204.467C204.746 29.9961 205.022 29.937 205.274 29.8229C205.526 29.7088 205.749 29.5424 205.925 29.336L213.404 20.6188C213.447 20.5653 213.502 20.5224 213.566 20.4937C213.63 20.465 213.7 20.4513 213.77 20.4539C213.84 20.4538 213.908 20.4687 213.971 20.4972C214.034 20.5257 214.09 20.5672 214.134 20.6188L221.64 29.3398C221.817 29.5454 222.04 29.711 222.292 29.8248C222.543 29.9385 222.818 29.9977 223.097 29.9978H227.114C227.472 29.9977 227.821 29.9007 228.123 29.7182C228.425 29.5357 228.666 29.2754 228.819 28.9672C228.971 28.659 229.029 28.3156 228.986 27.9771C228.942 27.6386 228.799 27.319 228.573 27.0551L228.569 27.0474Z"
                            fill="white" />
                        <path
                            d="M66.1015 21.7431C66.0572 21.6952 66.0246 21.6387 66.0058 21.5773C65.9871 21.516 65.9827 21.4515 65.993 21.3884C66.0045 21.319 66.0316 21.2528 66.0725 21.1945C66.1135 21.1361 66.1672 21.0871 66.23 21.0507C66.6824 20.7845 67.1123 20.485 67.5157 20.1548C68.8093 19.0781 69.8317 17.7364 70.5068 16.2297C71.2294 14.6372 71.5955 12.9181 71.5815 11.1825C71.6017 9.26317 71.1518 7.36592 70.2678 5.64217C69.4444 4.01378 68.1999 2.61271 66.6519 1.57132C65.1172 0.540718 63.2849 -0.00844015 61.4089 9.80731e-05H42.7148C42.2147 0.000605886 41.7352 0.190576 41.3816 0.528288C41.0279 0.866001 40.8291 1.32392 40.8285 1.80152V28.1889C40.8291 28.6665 41.0279 29.1244 41.3816 29.4621C41.7352 29.7999 42.2147 29.9899 42.7148 29.9904H45.7762C46.2763 29.9899 46.7558 29.7999 47.1095 29.4621C47.4631 29.1244 47.662 28.6665 47.6626 28.1889V7.56056C47.6626 7.441 47.7123 7.32627 47.8008 7.24173C47.8893 7.15718 48.0094 7.10977 48.1346 7.10977H61.4109C61.9764 7.10069 62.5301 7.26394 62.9918 7.5759C63.5355 7.94514 63.9712 8.44107 64.2574 9.01657C64.5957 9.69148 64.7649 10.4323 64.7515 11.1805C64.7633 11.9255 64.592 12.6627 64.2514 13.333C63.9651 13.9223 63.526 14.4321 62.9757 14.814C62.5225 15.1314 61.9729 15.2985 61.4109 15.2898H51.2001V22.3628H57.2125C57.279 22.3629 57.3448 22.3764 57.4057 22.4021C57.4666 22.4279 57.5212 22.4654 57.566 22.5124L63.9581 29.3823C64.1346 29.5722 64.3511 29.7244 64.5934 29.8289C64.8357 29.9333 65.0984 29.9878 65.3642 29.9886H69.5064C69.8689 29.989 70.2239 29.8895 70.5287 29.7022C70.8336 29.5148 71.0753 29.2475 71.225 28.9322C71.3747 28.6169 71.426 28.267 71.3727 27.9245C71.3194 27.5821 71.1639 27.2617 70.9246 27.0016L66.1035 21.7431H66.1015Z"
                            fill="white" />
                    </svg>
                </div>

                <div class="mt-[50px]">
                    <div class="flex w-full justify-between items-center">
                        <p class="text-[24px]"> ثبت نام در آرنیتکس</p>
                        <p class="text-[12px]  text-[#FF7028]"> ورود به آرنیتکس</p>
                    </div>

                    <div v-if="isUserHasAcc == 'firstStep'">
                        <div class="mt-[20px] flex flex-col">
                            <label class="text-[16px] my-2" for="">شماره همراه یا ایمیل</label>
                            <input v-model="email" type="text" placeholder="شماره همراه یا ایمیل خود را وارد کنید"
                                class="bg-[#262626] h-[58px] p-3 border-solid border-[2px] border-[#676767] rounded-[8px] placeholder-[#676767] text-[14px]">
                        </div>
                        <div class="mt-[20px] flex flex-col">
                            <label class="text-[16px] my-2" for=""> رمز عبور</label>

                            <input type="text" :class="{ 'error-border': errorPass }" v-model="Pass"
                                placeholder="رمز عبور خود را وارد کنید"
                                class="bg-[#262626] h-[58px] p-3 border-solid border-[2px] border-[#676767] rounded-[8px] placeholder-[#676767] text-[14px]">

                            <span class="text-[#EA3C53] text-[14px] mt-3" v-if="errorPass">{{ this.errorPass }}</span>
                        </div>
                        <button @click="sendOTP"
                        :class="buttonClass"
                            class="w-full h-[45px] sm:h-[51px] bg-[#262626] rounded-[8px] mt-5  text-[#676767] text-[20px]">
                            {{ registerText }}
                        </button>
                    </div>

                    <div v-if="isUserHasAcc == 'otp'">
                        <div class="mt-[20px] flex flex-col w-full">
                            <label class="text-[14px] my-2" for="">کد ۵ رقمی به شماره تلفن شما ارسال شد</label>

                            <div dir="ltr" class="flex justify-center mt-5 items-center">
                                <v-otp-input ref="otpInput" input-classes="otp-input"
                                    :conditionalClass="['one', 'two', 'three', 'four']" inputType="letter-numeric"
                                    :num-inputs="5" v-model:value="bindValue" :should-auto-focus="true"
                                    :should-focus-order="true" @on-change="handleOnChange"
                                    @on-complete="handleOnComplete" />
                            </div>


                        </div>
                        <div class=" w-full flex flex-col h-[40px] justify-center items-end">
                            <div class="" v-if="timer > 0">{{ formattedTimer }}</div>
                            <button @click="sendLoginOtpAgain" v-else v-show="showResendButton">
                                ارسال مجدد کد
                            </button>
                        </div>

                        <button @click="OTP"
                            class="w-full h-[45px] sm:h-[51px] bg-[#262626] rounded-[8px] mt-5  text-[#676767] text-[22px]">
                            ادامه
                        </button>

                        <span
                            class="text-[#008DAC] text-[12px] sm:text-[14px] relative top-3 items-center flex justify-center">بعد
                            از تکمیل نوشتار اطلاعات به طور خودکار کد بررسی شود</span>
                    </div>

                </div>

            </div>
        </div>

        <div class="w-[70%] hidden sm:flex justify-center items-center bg-black">
            <div
                class=" absolute left-2 w-[28.75rem] h-[18.125rem] md:w-[48.75rem] md:h-[28.125rem] lg:w-[58.75rem] lg:h-[33.125rem] xl:w-[68.75rem] xl:h-[38.125rem] 2xl:w-[88.75rem] 2xl:h-[48.125rem]">
                <img src="~/assets/images/Frame.png" alt="" class="h-full w-full" />
            </div>
        </div>
    </div>

</template>


<script>
import axios from 'axios';

export default {
    data() {
        return {
            isUserHasAcc: "firstStep",
            showResendButton: false,
            email: null,
            Pass: null,
            timer: 180,
            timerR: 180,
            errorPass: null,
            registerText: "ثبت نام"
        };
    },
    computed: {
        formattedTimer() {
            return this.formatTime(this.timer);
        },
        formattedTimerR() {
            return this.formatTimeR(this.timerR);
        },
        buttonClass() {
      return {
        'bg-[#262626] text-[#676767] transition ease-in-out': !this.email || !this.Pass,
        'bg-[#319B54] text-white transition ease-in-out': this.email && this.Pass
      };
    }
    },
    methods: {

        resetTimer(event) {
            event.preventDefault();
            this.timer = 120;
            this.showResendButton = false;
            if (this.timer > 0) {
                this.startTimer();
            }
        },
        resetTimerR(event) {
            event.preventDefault();
            this.timerR = 120;
            this.showResendButtonR = false;
            if (this.timerR > 0) {
                this.startTimerR();
            }
        },
        startTimer() {
            if (this.intervalId) {
                clearInterval(this.intervalId);
            }
            this.intervalId = setInterval(() => {
                if (this.timer > 0) {
                    this.timer--;
                } else {
                    this.showResendButton = true;
                    clearInterval(this.intervalId);
                }
            }, 1000);
        },
        startTimerR() {
            if (this.intervalIdR) {
                clearInterval(this.intervalIdR);
            }
            this.intervalIdR = setInterval(() => {
                if (this.timerR > 0) {
                    this.timerR--;
                } else {
                    this.showResendButtonR = true;
                    clearInterval(this.intervalIdR);
                }
            }, 1000);
        },
        formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const formattedSeconds =
                remainingSeconds < 10 ? `0${remainingSeconds}` : remainingSeconds;
            return `${formattedMinutes}:${formattedSeconds}`;
        },
        formatTimeR(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const formattedSeconds =
                remainingSeconds < 10 ? `0${remainingSeconds}` : remainingSeconds;
            return `${formattedMinutes}:${formattedSeconds}`;
        },

        sendLoginOtpAgain() {
            this.timer = 180;
            this.showResendButton = false;
            if (this.timer > 0) {
                this.startTimer();
            }
            let data = JSON.stringify({
                email: this.email,
            });
            let config = {
                method: "post",
                maxBodyLength: Infinity,
                url: "https://arnitex.ir/api/v1/accounts/send-otp/",
                headers: {
                    "Content-Type": "application/json",
                },
                data: data,
            };
            axios
                .request(config)
                .then((response) => {
                    console.log(response);
                    this.isUserHasAcc = "otp";
                    this.startTimer();

                })
                .catch((error) => {
                    console.log(error);
                });
        },
        
        sendOTP(event) {
            event.preventDefault();
            this.errorPass = null;
            let data = JSON.stringify({
                email: this.email,
            });

            const cleanedPass = this.Pass.replace(/\s+/g, '');
            if (cleanedPass && cleanedPass.length > 7) {
                this.registerText = " در حال پردازش ...";
                let config = {
                    method: "post",
                    maxBodyLength: Infinity,
                    url: "https://arnitex.ir/api/v1/accounts/send-otp/",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    data: data,
                };
                axios
                    .request(config)
                    .then((response) => {
                        console.log(response);
                        this.isUserHasAcc = "otp";
                        this.startTimer();

                    })
                    .catch((error) => {
                        console.log(error);
                        this.registerText = " ثبت نام";
                    });
            } else {
                this.errorPass = ' رمز عبور  باید بیشتر از 8 کارکتر باشد ';
            }
        },

        handleOnComplete() {
            let data = JSON.stringify({
                email: this.email,
                password1: this.Pass,
                password2: this.Pass,
                otp: this.otp,
            });

            let config = {
                method: "post",
                maxBodyLength: Infinity,
                url: "https://arnitex.ir/api/v1/accounts/register-verify/",
                headers: {
                    "Content-Type": "application/json",
                },
                data: data,
            };

            axios
                .request(config)
                .then((response) => {
                    console.log(response);
                    console.log(this.Pass);
                    // this.isUserHasAcc = "otp";

                })
                .catch((error) => {
                    console.log(error);
                });
        }
    },
};
</script>




<style>
.error-border {
    border-color: #EA3C53;
}

@media (min-width: 640px) {
    .sm\:bglogin {
        background: linear-gradient(0deg, #0b0b0b 0%, #242424 100%);
        ;
    }
}

.bgh {
    background: linear-gradient(0deg, #181818 0%, #242424 100%);
    ;
}


.otp-input {
    width: 40px;
    height: 50px;
    padding: 5px;
    margin: 0 10px;
    font-size: 20px;
    border-radius: 4px;
    background-color: #262626;
    border: 1px solid rgba(0, 0, 0, 0.3);
    text-align: center;
}

.otp-input::-webkit-inner-spin-button,
.otp-input::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
</style>
